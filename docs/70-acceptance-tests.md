# Acceptance Tests

これらのテストシナリオは、MVPのDone条件を定義します。すべてのシナリオが成功したら、MVPは完成です。

---

## 1. ページ管理

### Scenario 1.1: 新規ページ作成
**Given** ユーザーがログインしている
**When** 「新規ページ」ボタンをクリックする
**Then** 新しい空のページが作成される
**And** エディタ画面に遷移する
**And** タイトルは空欄で、ブロックは1つ（空の段落）が表示される
**And** サイドバーに新しいページが追加される

---

### Scenario 1.2: ページ一覧の表示
**Given** ユーザーが3つのページを作成済み
**When** ホーム画面を開く
**Then** サイドバーに3つのページがリスト表示される
**And** 各ページにタイトルと更新日時が表示される
**And** 更新日時が新しい順にソートされている

---

### Scenario 1.3: ページの削除
**Given** ユーザーがページを開いている
**When** 削除ボタンをクリックする
**Then** 確認ダイアログが表示される
**When** 「削除」を選択する
**Then** ページが削除される
**And** ホーム画面に遷移する
**And** サイドバーから削除されたページが消える

---

### Scenario 1.4: ページ削除のキャンセル
**Given** ユーザーがページを開いている
**When** 削除ボタンをクリックする
**Then** 確認ダイアログが表示される
**When** 「キャンセル」を選択する
**Then** ページは削除されない
**And** エディタ画面に戻る

---

## 2. エディタ機能

### Scenario 2.1: タイトルの編集
**Given** ユーザーがページを開いている
**When** タイトル欄に「My First Page」と入力する
**Then** 2秒後に自動保存される
**And** サイドバーのページタイトルが「My First Page」に更新される
**And** 保存インジケーターが「保存済み」と表示される

---

### Scenario 2.2: ブロックの追加と編集
**Given** ユーザーがページを開いている
**When** 最初の段落に「Hello World」と入力する
**And** Enterキーを押す
**Then** 新しい段落ブロックが追加される
**When** 新しいブロックに「Second paragraph」と入力する
**Then** 2秒後に自動保存される
**And** 保存インジケーターが「保存済み」と表示される

---

### Scenario 2.3: ブロックの削除
**Given** ユーザーがページに2つの段落ブロックがある
**When** 2番目のブロックにカーソルを移動する
**And** Backspaceキーを押して全文字を削除する
**And** さらにBackspaceキーを押す
**Then** 2番目のブロックが削除される
**And** 1番目のブロックにカーソルが移動する

---

### Scenario 2.4: マークダウン記法（見出し）
**Given** ユーザーがページを開いている
**When** 段落の先頭に「# 」と入力する
**Then** ブロックが見出し1（H1）に変換される
**And** 「# 」のマークは消える
**When** 「Welcome」と入力する
**Then** 「Welcome」が見出し1として表示される

---

### Scenario 2.5: マークダウン記法（箇条書き）
**Given** ユーザーがページを開いている
**When** 段落の先頭に「- 」と入力する
**Then** ブロックが箇条書きリストに変換される
**When** 「First item」と入力する
**And** Enterキーを押す
**Then** 新しい箇条書き項目が追加される

---

### Scenario 2.6: テキスト装飾（太字）
**Given** ユーザーがページを開いている
**When** 「This is **bold** text」と入力する
**Then** 「bold」の部分が太字で表示される

---

### Scenario 2.7: 自動保存（成功）
**Given** ユーザーがページを編集している
**When** タイトルまたはブロックを変更する
**Then** 保存インジケーターが「保存中...」と表示される
**And** 2秒後にAPIにPATCHリクエストが送信される
**And** 保存が成功すると「保存済み」と表示される

---

### Scenario 2.8: 自動保存（失敗）
**Given** ユーザーがページを編集している
**And** ネットワークが切断されている
**When** タイトルを変更する
**Then** 2秒後に保存が試行される
**And** エラーメッセージが表示される
**And** 「再試行」ボタンが表示される
**When** 「再試行」ボタンをクリックする
**Then** 保存が再試行される

---

## 3. 検索機能

### Scenario 3.1: ページの検索（タイトル）
**Given** ユーザーが以下のページを作成済み:
  - 「Project Plan」
  - 「Meeting Notes」
  - 「Project Ideas」
**When** 検索フィールドに「Project」と入力する
**Then** サイドバーに「Project Plan」と「Project Ideas」のみが表示される
**And** 「Meeting Notes」は表示されない

---

### Scenario 3.2: ページの検索（本文）
**Given** ユーザーが以下のページを作成済み:
  - 「Plan」（本文に「React」を含む）
  - 「Notes」（本文に「Vue」を含む）
**When** 検索フィールドに「React」と入力する
**Then** サイドバーに「Plan」のみが表示される

---

### Scenario 3.3: 検索結果が0件
**Given** ユーザーが3つのページを作成済み
**When** 検索フィールドに「xyz123」と入力する
**Then** サイドバーに「該当するページがありません」と表示される
**And** ページ一覧は空になる

---

## 4. UI/UX

### Scenario 4.1: ページ読み込み中の表示
**Given** ユーザーがページIDをURLで直接開く
**When** ページが読み込まれている間
**Then** スケルトンローダーが表示される
**And** タイトルとエディタエリアがローディング状態で表示される

---

### Scenario 4.2: ページが存在しない場合
**Given** ユーザーが存在しないページID（`/pages/invalid-uuid`）を開く
**When** ページが読み込まれる
**Then** 404エラーメッセージが表示される
**And** 「ホームに戻る」ボタンが表示される

---

### Scenario 4.3: Empty State（ページが0件）
**Given** ユーザーが初めてログインした
**And** ページが1つもない
**When** ホーム画面を開く
**Then** メインエリアに「まだページがありません」と表示される
**And** 「新規ページを作成」ボタンが表示される

---

### Scenario 4.4: ページ一覧のナビゲーション
**Given** ユーザーがページAを開いている
**When** サイドバーのページBをクリックする
**Then** ページBのエディタ画面に遷移する
**And** サイドバーでページBがハイライト表示される

---

## 5. 認証・権限

### Scenario 5.1: 未認証ユーザーのアクセス
**Given** ユーザーがログインしていない
**When** `/pages`にアクセスする
**Then** ログイン画面にリダイレクトされる

---

### Scenario 5.2: 他人のページへのアクセス（RLS）
**Given** ユーザーAがページXを作成済み
**And** ユーザーBがログインしている
**When** ユーザーBがページXのURL（`/pages/X`）に直接アクセスする
**Then** 403 Forbiddenエラーが表示される
**Or** ページが見つからないエラーが表示される

---

## 6. エッジケース

### Scenario 6.1: タイトルの文字数制限
**Given** ユーザーがページを開いている
**When** タイトル欄に201文字を入力しようとする
**Then** 200文字までしか入力できない
**And** バリデーションエラーが表示される（optional）

---

### Scenario 6.2: 空のページの保存
**Given** ユーザーが新規ページを作成した
**When** タイトルとブロックを空のままにする
**Then** ページは保存される（タイトル: ""、ブロック: []）
**And** サイドバーに「Untitled」または空白で表示される

---

## テストツール

- **Unit Tests**: Vitest + React Testing Library
- **E2E Tests**: Playwright
- **Test Coverage**: 70%以上（MVP目標）

---

## MVP完了の定義（Definition of Done）

以下の条件をすべて満たしたら、MVPは完成:

1. 上記のすべてのAcceptance Testが成功する
2. E2Eテストがすべてパスする
3. ビルドがエラーなく成功する
4. Lintエラーがゼロ
5. ページ作成から保存まで3秒以内（Success Metrics）
6. エディタ操作のレスポンスタイム100ms以内（Success Metrics）
7. デプロイ済み（Vercel + Supabase）
